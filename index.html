<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <title>Bảng Dữ Liệu Yêu Cầu</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        padding: 20px;
        background-color: #f8f9fa;
      }
      .table-container {
        margin-top: 20px;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      th {
        background-color: #0d6efd;
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .table-responsive {
        max-height: 80vh;
        overflow-y: auto;
      }

      /* Tô màu theo trạng thái (Cột E) */
      .status-Đang-xử-lý {
        background-color: #fff3cd;
      } /* Màu vàng nhạt */
      .status-Hoàn-thành {
        background-color: #d4edda;
      } /* Màu xanh lá nhạt */
    </style>
  </head>
  <body>
    <div class="container table-container">
      <h2 class="text-center text-primary mb-4">Danh Sách Yêu Cầu Dịch Vụ</h2>

      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
          <thead>
            <tr>
              <? for (let i = 0; i < headers.length; i++) { ?>
              <th><?= headers[i] ?></th>
              <? } ?>
            </tr>
          </thead>
          <tbody>
            <? for (let i = 0; i < dataRows.length; i++) { 
                        const row = dataRows[i];
                        
                        // Lấy trạng thái từ Cột 5 (index 4) và chuẩn hóa để tạo class CSS
                        const rawStatus = row[4] ? row[4].toString() : '';
                        const statusClass = rawStatus.replace(/\s/g, '-'); 
                        const rowClass = statusClass ? `status-${statusClass}` : '';
                    ?>
            <tr class="<?= rowClass ?>">
              <? for (let j = 0; j < row.length; j++) { 
                                let cellValue = row[j];
                                
                                // Định dạng lại ngày nếu Sheet lưu dưới dạng Date Object (Mặc dù doPost lưu dạng string, việc này để đảm bảo)
                                if (j === 0 && cellValue instanceof Date) { // Cột Ngày là cột đầu tiên (index 0)
                                    cellValue = Utilities.formatDate(cellValue, Session.getScriptTimeZone(), "dd/MM/yyyy");
                                }
                                
                                // Xử lý trường hợp giá trị null/empty
                                cellValue = cellValue === '' ? '—' : cellValue;
                            ?>
              <td><?= cellValue ?></td>
              <? } ?>
            </tr>
            <? } ?>
            <? if (dataRows.length === 0) { ?>
            <tr>
              <td
                colspan="<?= headers.length ?>"
                class="text-center text-danger"
              >
                Chưa có yêu cầu nào được gửi.
              </td>
            </tr>
            <? } ?>
          </tbody>
        </table>
      </div>
      <p class="mt-4 text-center text-muted">
        <small>Dữ liệu được làm mới theo thời gian thực từ Google Sheet.</small>
      </p>
    </div>
  </body>
</html>
