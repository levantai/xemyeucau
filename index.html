<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh S√°ch Y√™u C·∫ßu D·ªãch V·ª•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .table-container { margin-top: 20px; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        th { background-color: #0d6efd; color: white; position: sticky; top: 0; z-index: 10; }
        .table-responsive { max-height: 80vh; overflow-y: auto; }
        
        /* T√¥ m√†u theo tr·∫°ng th√°i (ƒê√£ chu·∫©n h√≥a t·ª´ Code.gs: 'ƒêang x·ª≠ l√Ω' -> 'ƒêang-x·ª≠-l√Ω') */
        .status-ƒêang-x·ª≠-l√Ω { background-color: #fff3cd; } /* M√†u v√†ng nh·∫°t */
        .status-Ho√†n-th√†nh { background-color: #d4edda; } /* M√†u xanh l√° nh·∫°t */
        
        /* Hi·ªáu ·ª©ng khi ƒëang t·∫£i */
        #loading-message {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container table-container">
        <h2 class="text-center text-primary mb-4">üìã Danh S√°ch Y√™u C·∫ßu D·ªãch V·ª•</h2>

        <div class="table-responsive" id="table-container">
            <div id="loading-message">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet...</div>
            </div>
    </div>

    <script>
        // *****************************************************************************************
        // üî• B·∫ÆT BU·ªòC: THAY TH·∫æ URL N√ÄY B·∫∞NG URL WEB APP CH√çNH TH·ª®C C·ª¶A B·∫†N.
        // URL ph·∫£i tr·ªè ƒë·∫øn h√†m getDataApi() trong Code.gs
        const API_URL = "https://script.google.com/macros/s/AKfycbxV1gA2b-N7p_l1Kvta6duMIgJmdrLOsyJr9CS_ij-P_LFdd9lD6NPOZl2m7u1tWxI1Dw/exec"; 
        // *****************************************************************************************

        const container = document.getElementById('table-container');

        // H√†m ch√≠nh ƒë·ªÉ t·∫°o b·∫£ng HTML t·ª´ d·ªØ li·ªáu JSON
        function createTable(data) {
            const { headers, data: dataRows } = data;
            
            if (!dataRows || dataRows.length === 0) {
                container.innerHTML = '<p class="text-center text-danger">Kh√¥ng c√≥ d·ªØ li·ªáu y√™u c·∫ßu.</p>';
                return;
            }

            // T·∫°o ti√™u ƒë·ªÅ b·∫£ng (<thead>)
            const headerHtml = `<thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>`;

            // T·∫°o n·ªôi dung b·∫£ng (<tbody>)
            const bodyHtml = dataRows.map(row => {
                // L·∫•y tr·∫°ng th√°i t·ª´ C·ªôt 5 (index 4) v√† chu·∫©n h√≥a
                const rawStatus = row[4] ? row[4].toString() : '';
                const statusClass = rawStatus.replace(/\s/g, '-'); 
                const rowClass = statusClass ? `status-${statusClass}` : '';
                
                // T·∫°o c√°c √¥ (<td>) cho m·ªói h√†ng
                const cellHtml = row.map(cell => `<td>${cell === '' ? '‚Äî' : cell}</td>`).join('');
                
                return `<tr class="${rowClass}">${cellHtml}</tr>`;
            }).join('');

            // K·∫øt h·ª£p l·∫°i th√†nh b·∫£ng ho√†n ch·ªânh
            const html = `
                <table class="table table-bordered table-hover align-middle">
                    ${headerHtml}
                    <tbody>${bodyHtml}</tbody>
                </table>
                <p class="mt-4 text-center text-muted"><small>D·ªØ li·ªáu ƒë∆∞·ª£c l√†m m·ªõi theo th·ªùi gian th·ª±c.</small></p>
            `;
            
            // Ch√®n b·∫£ng v√†o container
            container.innerHTML = html;
        }
        
        // H√†m fetch d·ªØ li·ªáu t·ª´ Google Apps Script API
        function fetchData() {
            fetch(API_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                         container.innerHTML = `<p class="text-center text-danger">L·ªói API: ${data.error}. Ki·ªÉm tra l·∫°i t√™n sheet ho·∫∑c quy·ªÅn truy c·∫≠p Apps Script.</p>`;
                    } else {
                        createTable(data);
                    }
                })
                .catch(error => {
                    console.error("L·ªói khi t·∫£i d·ªØ li·ªáu:", error);
                    container.innerHTML = `<p class="text-center text-danger">‚ùå L·ªói k·∫øt n·ªëi: ${error.message}. Vui l√≤ng ki·ªÉm tra l·∫°i URL API v√† k·∫øt n·ªëi m·∫°ng.</p>`;
                });
        }
        
        // B·∫Øt ƒë·∫ßu t·∫£i d·ªØ li·ªáu khi trang ƒë∆∞·ª£c t·∫£i xong
        fetchData();

    </script>
</body>
</html>
